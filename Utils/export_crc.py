import pefile
import binascii
import sqlite3



conn = sqlite3.connect('api-hash.db')
cursor = conn.cursor()

dll_list = ['advapi32.dll', 'msvcrt.dll', 'comctl32.dll', 'gdi32.dll', 'kernel32.dll', 'mpr.dll', 'msvcrt.dll', 'ole32.dll', 'shell32.dll', 'user32.dll', 'wsock32.dll', 'ntoskrnl.exe']
base_dir = 'C:\\Windows\\System32\\'

for dll in dll_list:
	pe =  pefile.PE('C:\\Windows\\System32\\' + dll)

	for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
		if exp.name:
			cursor.execute("""
			INSERT INTO exports (name, address, crc32)
			VALUES (?,?,?)
			""", (str(exp.name), str(hex(pe.OPTIONAL_HEADER.ImageBase + exp.address)), str(hex(binascii.crc32(exp.name)))))

conn.commit()
conn.close()
